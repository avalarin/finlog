create extension if not exists "uuid-ossp";

create table prod.currencies (
    code varchar(3) primary key,
    name varchar(100) not null,
    flag varchar(4) not null
);

insert into prod.currencies (code, name, flag) VALUES
  ('USD', 'United States Dollar', 'ğŸ‡ºğŸ‡¸'),
  ('EUR', 'Euro', 'ğŸ‡ªğŸ‡º'),
  ('GBP', 'Pound Sterling', 'ğŸ‡¬ğŸ‡§'),
  ('JPY', 'Japanese Yen', 'ğŸ‡¯ğŸ‡µ'),
  ('CHF', 'Swiss Franc', 'ğŸ‡¨ğŸ‡­'),
  ('CAD', 'Canadian Dollar', 'ğŸ‡¨ğŸ‡¦'),
  ('AUD', 'Australian Dollar', 'ğŸ‡¦ğŸ‡º'),
  ('NZD', 'New Zealand Dollar', 'ğŸ‡³ğŸ‡¿'),
  ('CNY', 'Chinese Yuan', 'ğŸ‡¨ğŸ‡³'),
  ('HKD', 'Hong Kong Dollar', 'ğŸ‡­ğŸ‡°'),
  ('SGD', 'Singapore Dollar', 'ğŸ‡¸ğŸ‡¬'),
  ('KRW', 'South Korean Won', 'ğŸ‡°ğŸ‡·'),
  ('INR', 'Indian Rupee', 'ğŸ‡®ğŸ‡³'),
  ('RUB', 'Russian Ruble', 'ğŸ‡·ğŸ‡º'),
  ('TRY', 'Turkish Lira', 'ğŸ‡¹ğŸ‡·'),
  ('BRL', 'Brazilian Real', 'ğŸ‡§ğŸ‡·'),
  ('ZAR', 'South African Rand', 'ğŸ‡¿ğŸ‡¦'),
  ('SAR', 'Saudi Riyal', 'ğŸ‡¸ğŸ‡¦'),
  ('AED', 'United Arab Emirates Dirham', 'ğŸ‡¦ğŸ‡ª'),
  ('AMD', 'Armenian Dram', 'ğŸ‡¦ğŸ‡²'),
  ('KZT', 'Kazakhstani Tenge', 'ğŸ‡°ğŸ‡¿'),
  ('IDR', 'Indonesian Rupiah', 'ğŸ‡®ğŸ‡©'),
  ('BTC', 'Bitcoin', 'ğŸª™');

create table prod.countries (
  id serial primary key,
  name varchar(100) not null,
  flag varchar(4) not null
);

insert into prod.countries (name, flag) values
('Afghanistan', 'ğŸ‡¦ğŸ‡«'),
('Albania', 'ğŸ‡¦ğŸ‡±'),
('Algeria', 'ğŸ‡©ğŸ‡¿'),
('Andorra', 'ğŸ‡¦ğŸ‡©'),
('Angola', 'ğŸ‡¦ğŸ‡´'),
('Antigua and Barbuda', 'ğŸ‡¦ğŸ‡¬'),
('Argentina', 'ğŸ‡¦ğŸ‡·'),
('Armenia', 'ğŸ‡¦ğŸ‡²'),
('Australia', 'ğŸ‡¦ğŸ‡º'),
('Austria', 'ğŸ‡¦ğŸ‡¹'),
('Azerbaijan', 'ğŸ‡¦ğŸ‡¿'),
('Bahamas', 'ğŸ‡§ğŸ‡¸'),
('Bahrain', 'ğŸ‡§ğŸ‡­'),
('Bangladesh', 'ğŸ‡§ğŸ‡©'),
('Barbados', 'ğŸ‡§ğŸ‡§'),
('Belarus', 'ğŸ‡§ğŸ‡¾'),
('Belgium', 'ğŸ‡§ğŸ‡ª'),
('Belize', 'ğŸ‡§ğŸ‡¿'),
('Benin', 'ğŸ‡§ğŸ‡¯'),
('Bhutan', 'ğŸ‡§ğŸ‡¹'),
('Bolivia', 'ğŸ‡§ğŸ‡´'),
('Bosnia and Herzegovina', 'ğŸ‡§ğŸ‡¦'),
('Botswana', 'ğŸ‡§ğŸ‡¼'),
('Brazil', 'ğŸ‡§ğŸ‡·'),
('Brunei', 'ğŸ‡§ğŸ‡³'),
('Bulgaria', 'ğŸ‡§ğŸ‡¬'),
('Burkina Faso', 'ğŸ‡§ğŸ‡«'),
('Burundi', 'ğŸ‡§ğŸ‡®'),
('Cabo Verde', 'ğŸ‡¨ğŸ‡»'),
('Cambodia', 'ğŸ‡°ğŸ‡­'),
('Cameroon', 'ğŸ‡¨ğŸ‡²'),
('Canada', 'ğŸ‡¨ğŸ‡¦'),
('Central African Republic', 'ğŸ‡¨ğŸ‡«'),
('Chad', 'ğŸ‡¹ğŸ‡©'),
('Chile', 'ğŸ‡¨ğŸ‡±'),
('China', 'ğŸ‡¨ğŸ‡³'),
('Colombia', 'ğŸ‡¨ğŸ‡´'),
('Comoros', 'ğŸ‡°ğŸ‡²'),
('Congo', 'ğŸ‡¨ğŸ‡¬'),
('Costa Rica', 'ğŸ‡¨ğŸ‡·'),
('Croatia', 'ğŸ‡­ğŸ‡·'),
('Cuba', 'ğŸ‡¨ğŸ‡º'),
('Cyprus', 'ğŸ‡¨ğŸ‡¾'),
('Czechia', 'ğŸ‡¨ğŸ‡¿'),
('Denmark', 'ğŸ‡©ğŸ‡°'),
('Djibouti', 'ğŸ‡©ğŸ‡¯'),
('Dominica', 'ğŸ‡©ğŸ‡²'),
('Dominican Republic', 'ğŸ‡©ğŸ‡´'),
('Ecuador', 'ğŸ‡ªğŸ‡¨'),
('Egypt', 'ğŸ‡ªğŸ‡¬'),
('El Salvador', 'ğŸ‡¸ğŸ‡»'),
('Equatorial Guinea', 'ğŸ‡¬ğŸ‡¶'),
('Eritrea', 'ğŸ‡ªğŸ‡·'),
('Estonia', ''),
('Ethiopia', 'ğŸ‡ªğŸ‡¹'),
('Fiji', 'ğŸ‡«ğŸ‡¯'),
('Finland', 'ğŸ‡«ğŸ‡®'),
('France', 'ğŸ‡«ğŸ‡·'),
('Gabon', 'ğŸ‡¬ğŸ‡¦'),
('Gambia', 'ğŸ‡¬ğŸ‡²'),
('Georgia', 'ğŸ‡¬ğŸ‡ª'),
('Germany', 'ğŸ‡©ğŸ‡ª'),
('Ghana', 'ğŸ‡¬ğŸ‡­'),
('Greece', 'ğŸ‡¬ğŸ‡·'),
('Grenada', 'ğŸ‡¬ğŸ‡©'),
('Guatemala', 'ğŸ‡¬ğŸ‡¹'),
('Guinea', 'ğŸ‡¬ğŸ‡³'),
('Guinea-Bissau', 'ğŸ‡¬ğŸ‡¼'),
('Guyana', 'ğŸ‡¬ğŸ‡¾'),
('Haiti', 'ğŸ‡­ğŸ‡¹'),
('Honduras', 'ğŸ‡­ğŸ‡³'),
('Hungary', 'ğŸ‡­ğŸ‡º'),
('Iceland', 'ğŸ‡®ğŸ‡¸'),
('India', 'ğŸ‡®ğŸ‡³'),
('Indonesia', 'ğŸ‡®ğŸ‡©'),
('Iran', 'ğŸ‡®ğŸ‡·'),
('Iraq', 'ğŸ‡®ğŸ‡¶'),
('Ireland', 'ğŸ‡®ğŸ‡ª'),
('Israel', 'ğŸ‡®ğŸ‡±'),
('Italy', 'ğŸ‡®ğŸ‡¹'),
('Jamaica', 'ğŸ‡¯ğŸ‡²'),
('Japan', 'ğŸ‡¯ğŸ‡µ'),
('Jordan', 'ğŸ‡¯ğŸ‡´'),
('Kazakhstan', 'ğŸ‡°ğŸ‡¿'),
('Kenya', 'ğŸ‡°ğŸ‡ª'),
('Kiribati', 'ğŸ‡°ğŸ‡®'),
('Kuwait', 'ğŸ‡°ğŸ‡¼'),
('Kyrgyzstan', 'ğŸ‡°ğŸ‡¬'),
('Laos', 'ğŸ‡±ğŸ‡¦'),
('Latvia', 'ğŸ‡±ğŸ‡»'),
('Lebanon', 'ğŸ‡±ğŸ‡§'),
('Lesotho', 'ğŸ‡±ğŸ‡¸'),
('Liberia', 'ğŸ‡±ğŸ‡·'),
('Libya', 'ğŸ‡±ğŸ‡¾'),
('Liechtenstein', 'ğŸ‡±ğŸ‡®'),
('Lithuania', 'ğŸ‡±ğŸ‡¹'),
('Luxembourg', 'ğŸ‡±ğŸ‡º'),
('Madagascar', 'ğŸ‡²ğŸ‡¬'),
('Malawi', 'ğŸ‡²ğŸ‡¼'),
('Malaysia', 'ğŸ‡²ğŸ‡¾'),
('Maldives', 'ğŸ‡²ğŸ‡»'),
('Mali', 'ğŸ‡²ğŸ‡±'),
('Malta', 'ğŸ‡²ğŸ‡¹'),
('Marshall Islands', 'ğŸ‡²ğŸ‡­'),
('Mauritania', 'ğŸ‡²ğŸ‡·'),
('Mauritius', 'ğŸ‡²ğŸ‡º'),
('Mexico', 'ğŸ‡²ğŸ‡½'),
('Micronesia', 'ğŸ‡«ğŸ‡²'),
('Moldova', 'ğŸ‡²ğŸ‡©'),
('Monaco', 'ğŸ‡²ğŸ‡¨'),
('Mongolia', 'ğŸ‡²ğŸ‡³'),
('Montenegro', 'ğŸ‡²ğŸ‡ª'),
('Morocco', 'ğŸ‡²ğŸ‡¦'),
('Mozambique', 'ğŸ‡²ğŸ‡¿'),
('Namibia', 'ğŸ‡³ğŸ‡¦'),
('Nauru', 'ğŸ‡³ğŸ‡·'),
('Nepal', 'ğŸ‡³ğŸ‡µ'),
('Netherlands', 'ğŸ‡³ğŸ‡±'),
('New Zealand', 'ğŸ‡³ğŸ‡¿'),
('Nicaragua', 'ğŸ‡³ğŸ‡®'),
('Niger', 'ğŸ‡³ğŸ‡ª'),
('Nigeria', 'ğŸ‡³ğŸ‡¬'),
('North Korea', 'ğŸ‡°ğŸ‡µ'),
('North Macedonia', 'ğŸ‡²ğŸ‡°'),
('Norway', 'ğŸ‡³ğŸ‡´'),
('Oman', 'ğŸ‡´ğŸ‡²'),
('Pakistan', 'ğŸ‡µğŸ‡°'),
('Palau', 'ğŸ‡µğŸ‡¼'),
('Panama', 'ğŸ‡µğŸ‡¦'),
('Papua New Guinea', 'ğŸ‡µğŸ‡¬'),
('Paraguay', 'ğŸ‡µğŸ‡¾'),
('Peru', 'ğŸ‡µğŸ‡ª'),
('Philippines', 'ğŸ‡µğŸ‡­'),
('Poland', 'ğŸ‡µğŸ‡±'),
('Portugal', 'ğŸ‡µğŸ‡¹'),
('Qatar', 'ğŸ‡¶ğŸ‡¦'),
('Romania', 'ğŸ‡·ğŸ‡´'),
('Russia', 'ğŸ‡·ğŸ‡º'),
('Rwanda', 'ğŸ‡·ğŸ‡¼'),
('Saint Kitts and Nevis', 'ğŸ‡°ğŸ‡³'),
('Saint Lucia', 'ğŸ‡±ğŸ‡¨'),
('Saint Vincent and the Grenadines', 'ğŸ‡»ğŸ‡¨'),
('Samoa', 'ğŸ‡¼ğŸ‡¸'),
('San Marino', 'ğŸ‡¸ğŸ‡²'),
('Sao Tome and Principe', 'ğŸ‡¸ğŸ‡¹'),
('Saudi Arabia', 'ğŸ‡¸ğŸ‡¦'),
('Senegal', 'ğŸ‡¸ğŸ‡³'),
('Serbia', 'ğŸ‡·ğŸ‡¸'),
('Seychelles', 'ğŸ‡¸ğŸ‡¨'),
('Sierra Leone', 'ğŸ‡¸ğŸ‡±'),
('Singapore', 'ğŸ‡¸ğŸ‡¬'),
('Slovakia', 'ğŸ‡¸ğŸ‡°'),
('Slovenia', 'ğŸ‡¸ğŸ‡®'),
('Solomon Islands', 'ğŸ‡¸ğŸ‡§'),
('Somalia', 'ğŸ‡¸ğŸ‡´'),
('South Africa', 'ğŸ‡¿ğŸ‡¦'),
('South Korea', 'ğŸ‡°ğŸ‡·'),
('South Sudan', 'ğŸ‡¸ğŸ‡¸'),
('Spain', 'ğŸ‡ªğŸ‡¸'),
('Sri Lanka', 'ğŸ‡±ğŸ‡°'),
('Sudan', 'ğŸ‡¸ğŸ‡©'),
('Suriname', 'ğŸ‡¸ğŸ‡·'),
('Sweden', 'ğŸ‡¸ğŸ‡ª'),
('Switzerland', 'ğŸ‡¨ğŸ‡­'),
('Syria', 'ğŸ‡¸ğŸ‡¾'),
('Taiwan', 'ğŸ‡¹ğŸ‡¼'),
('Tajikistan', 'ğŸ‡¹ğŸ‡¯'),
('Tanzania', 'ğŸ‡¹ğŸ‡¿'),
('Thailand', 'ğŸ‡¹ğŸ‡­'),
('Timor-Leste', 'ğŸ‡¹ğŸ‡±'),
('Togo', 'ğŸ‡¹ğŸ‡¬'),
('Tonga', 'ğŸ‡¹ğŸ‡´'),
('Trinidad and Tobago', 'ğŸ‡¹ğŸ‡¹'),
('Tunisia', 'ğŸ‡¹ğŸ‡³'),
('Turkey', 'ğŸ‡¹ğŸ‡·'),
('Turkmenistan', 'ğŸ‡¹ğŸ‡²'),
('Tuvalu', 'ğŸ‡¹ğŸ‡»'),
('Uganda', 'ğŸ‡ºğŸ‡¬'),
('Ukraine', 'ğŸ‡ºğŸ‡¦'),
('United Arab Emirates', 'ğŸ‡¦ğŸ‡ª'),
('United Kingdom', 'ğŸ‡¬ğŸ‡§'),
('United States', 'ğŸ‡ºğŸ‡¸'),
('Uruguay', 'ğŸ‡ºğŸ‡¾'),
('Uzbekistan', 'ğŸ‡ºğŸ‡¿'),
('Vanuatu', 'ğŸ‡»ğŸ‡º'),
('Vatican City', 'ğŸ‡»ğŸ‡¦'),
('Venezuela', 'ğŸ‡»ğŸ‡ª'),
('Vietnam', 'ğŸ‡»ğŸ‡³'),
('Yemen', 'ğŸ‡¾ğŸ‡ª'),
('Zambia', 'ğŸ‡¿ğŸ‡²'),
('Zimbabwe', 'ğŸ‡¿ğŸ‡¼'),
('None', 'ğŸŒ');

create table prod.currency_rates (
  id serial primary key,
  from_currency varchar(3) not null,
  to_currency varchar(3) not null,
  date timestamp not null,
  value numeric(20, 10) not null,
  source varchar(50) not null
);
create index idx_currency_rates_from_to ON prod.currency_rates (from_currency, to_currency);

create table prod.operation_categories (
  id serial primary key,
  name varchar(100) not null unique,
  description varchar(100) not null default ''
);

insert into prod.operation_categories (name) values
('ğŸ’° Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ'),
('ğŸ¥¦ ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ'),
('ğŸš— ĞœĞ°ÑˆĞ¸Ğ½Ğ°'),
('ğŸ‘¾ Ğ Ğ°Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ'),
('ğŸ“± ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸'),
('ğŸ¡ ĞšĞ²Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°'),
('âœˆï¸ ĞŸÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ñ'),
('ğŸ’Š Ğ›ĞµÑ‡ĞµĞ½Ğ¸Ğµ'),
('ğŸ’„ ĞšĞ¾ÑĞ¼ĞµÑ‚Ğ¸ĞºĞ°'),
('ğŸ€ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚'),
('ğŸ½ï¸ Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‹'),
('ğŸ‘• ĞĞ´ĞµĞ¶Ğ´Ğ°'),
('ğŸš• Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'),
('ğŸ ĞŸĞ¾Ğ´Ğ°Ñ€ĞºĞ¸'),
('ğŸ“† Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾Ğµ'),
('ğŸ’» Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ°'),
('ğŸ§ CĞ½ÑÑ‚Ğ¸Ğµ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ…'),
('ğŸ’¸ ĞšĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸'),
('ğŸ’¸ ĞŸĞ¾Ñ‚ĞµÑ€Ğ¸'),
('ğŸ’¼ Ğ—Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°'),
('ğŸ’¼ Ğ”Ğ¾Ğ»Ğ³Ğ¸'),
('ğŸ’¼ ĞĞ°Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ'),
('ğŸ’¼ Ğ Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚Ñ‹'),
('ğŸ¦ ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚Ñ‹'),
('ğŸ ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°'),
('ğŸ‘« ĞœĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ±Ğ¾Ğ¹'),
('ğŸ‡°ğŸ‡¿ Ğ’ ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½'),
('ğŸ”® Ğ’ Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ¸Ñ'),
('ğŸ’± ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ');

create table prod.account_categories (
  code varchar(20) primary key,
  name varchar(100) not null unique,
  description varchar(200) not null default ''
);

insert into prod.account_categories (code, name, description) values
('current', 'Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹', 'Ğ”Ğ»Ñ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ñ‚Ñ€Ğ°Ñ‚'),
('savings', 'ĞĞ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ¸Ñ', 'Ğ¡Ñ‡ĞµÑ‚Ğ°, Ñ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ½Ğµ Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ğ¼'),
('unavailable', 'ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾', 'Ğ”Ğ¾Ğ»Ğ³Ğ¸, Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ, Ğ·Ğ°Ğ²Ğ¸ÑÑˆĞ¸Ğµ ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ°');

create table prod.users (
  id serial primary key,
  name varchar(100) not null unique,
  full_name varchar(100) not null
);

create table prod.accounts(
  id serial primary key,
  name varchar(100) not null unique,
  currency varchar(3) not null references prod.currencies (code),
  category varchar(20) not null references prod.account_categories (code),
  country_id integer not null references prod.countries (id),
  owner_id integer not null references prod.users (id),
  comment varchar(200) not null default '',
  created_at timestamp not null default now()
);

create type transaction_type as enum ('spending', 'income', 'movement');

create table prod.operations(
  id serial primary key,
  tx_id uuid not null default uuid_generate_v4(),
  tx_seq integer not null default 1,
  tx_type transaction_type not null,
  date timestamp not null,
  amount numeric(20, 10) not null,
  currency varchar(3) not null references prod.currencies (code),
  account_id integer not null references prod.accounts (id),
  exchange_rate numeric(20, 10) not null,
  category_id integer not null references prod.operation_categories (id),
  comment varchar(200) not null default '',
  created_at timestamp not null default now()
);

